(function(d,f,c){var a=d(document);c=f.Modernizr;d(document).ready(function(){d.fn.foundationAlerts&&a.foundationAlerts();d.fn.foundationButtons&&a.foundationButtons();d.fn.foundationAccordion&&a.foundationAccordion();d.fn.foundationNavigation&&a.foundationNavigation();d.fn.foundationTopBar&&a.foundationTopBar();d.fn.foundationCustomForms&&a.foundationCustomForms();d.fn.foundationMediaQueryViewer&&a.foundationMediaQueryViewer();d.fn.foundationTabs&&a.foundationTabs({callback:d.foundation.customForms.appendCustomMarkup});
d.fn.foundationTooltips&&a.foundationTooltips();d.fn.foundationMagellan&&a.foundationMagellan();d.fn.foundationClearing&&a.foundationClearing();d.fn.placeholder&&d("input, textarea").placeholder()});c.touch&&!f.location.hash&&d(f).load(function(){setTimeout(function(){f.scrollTo(0,1)},0)})})(jQuery,this);var BundleContentNode=function(){function d(d,c,a,b){this.url=d;this.name=c;this.parent=a;this.children=b}d.prototype.isRootNode=function(){return void 0===this.parent};d.prototype.isLeafNode=function(){return null===this.children};d.prototype.getUrl=function(){return this.url};d.prototype.getName=function(){return this.name};d.prototype.getFullName=function(){return this.isRootNode()?this.name:[this.parent.getFullName(),this.name].join("/")};d.prototype.getParent=function(){return this.parent};d.prototype.getChildren=
function(){return this.children};d.prototype.setChildren=function(d){this.children=d};d.prototype.getData=function(){return this.data};d.prototype.setData=function(d){this.data=d};return d}(),BundleRenderer=function(){function d(d){this.template=d}d.loadContentAsync=function(f,c){$.ajax({type:"GET",url:[c.getUrl(),c.getFullName()].join("/"),cache:!1,success:function(a){var b=[];Array.isArray(a)&&2==a.length&&(b=a[0].map(function(a){return new BundleContentNode(c.getUrl(),a,c)}),a=a[1].map(function(a){return new BundleContentNode(c.getUrl(),
a,c,null)}),b=b.concat(a).sort(function(a,b){return a.getName().localeCompare(b.getName())}));c.setChildren(b);d.renderTable(f,d.getContentTableModel(c,f))},error:function(a,b,e){}})};d.loadFileContentAsync=function(f,c){$.ajax({type:"GET",url:[c.getUrl().replace("api/bundles/content","api/bundles/filecontent"),c.getFullName()].join("/"),cache:!1,success:function(a){c.setData(a);d.renderTable(f,d.getContentTableModel(c,f))},error:function(a,b,e){}})};d.getContentTableModel=function(f,c){var a=0;!1==
f.isRootNode()&&(a+=1);if(f.isLeafNode())a+=1;else{var b=f.getChildren();void 0!==b&&(a+=b.length)}var e=function(a){a.setAttribute("class","col bundle__file_view__icon");var b=document.createElement("i");b.setAttribute("class","fi-arrow-left");a.appendChild(b);b.onclick=function(a){d.loadContentAsync(c,f.getParent());a.preventDefault()}},k=function(a){a.setAttribute("class","col bundle-item-type-goup");for(var b=[],e=f.getParent();void 0!==e;)b.push(e),e=e.getParent();b.reverse().forEach(function(b){var e=
document.createElement("a");e.textContent=b.getName();e.setAttribute("href","");e.onclick=function(a){d.loadContentAsync(c,b);a.preventDefault()};a.appendChild(e);a.appendChild(document.createTextNode(" / "))});a.appendChild(document.createTextNode(f.getName()))},g=function(a,b){a.setAttribute("class","col bundle__file_view__icon");var e=document.createElement("i");void 0!==b&&e.setAttribute("class",b.isLeafNode()?"fi-page":"fi-folder");a.appendChild(e)},h=function(a,b){if(b.isLeafNode()){a.setAttribute("class",
"col");var e=document.createElement("a");e.textContent=b.getName();e.setAttribute("href","");e.onclick=function(a){d.loadFileContentAsync(c,b);a.preventDefault()}}else a.setAttribute("class","col bundle-item-type-folder"),e=document.createElement("a"),e.textContent=b.getName(),e.setAttribute("href",""),e.onclick=function(a){d.loadContentAsync(c,b);a.preventDefault()};a.appendChild(e)},b=function(a,b){var e=document.createElement("img"),c=[b.getUrl().replace("api/bundles/content","api/bundles/filecontent"),
b.getFullName()].join("/");e.setAttribute("src",c);e.setAttribute("style","max-width:900px");return[e]},l=function(a,b){var e=document.createElement("iframe"),c=[b.getUrl().replace("api/bundles/content","api/bundles/filecontent"),b.getFullName()].join("/");e.setAttribute("src",c);e.setAttribute("style","width:100%; min-height:"+Math.max(200,Math.min(900,screen.height/2))+"px;");return[e]},m={txt:function(a,b){var e=document.createElement("pre");e.setAttribute("class","bundle__file_pre");e.textContent=
b.getData();return[e]},htm:l,html:l,jpg:b,png:b},n=function(a,b){var e=b.getName(),c="";0<e.indexOf(".")&&(c=e.toLowerCase().split(".").pop());e=m[c];void 0===e&&(e=m.txt);a.setAttribute("class","col");e(a,b).forEach(function(b){a.appendChild(b)})};return{tableDecorations:"bundle__file_view expanded",rowDecorations:"row",numRows:a,numCols:2,render:function(a,b,c){if(!1===f.isRootNode()&&0>=a)0==b?e(c):k(c);else if(!0===f.isLeafNode())0==b?g(c):n(c,f);else{var d=0;!1===f.isRootNode()&&(d=1);a=f.getChildren()[a-
d];0==b?g(c,a):h(c,a)}}}};d.getMetadataTableModel=function(d){var c=[],a;for(a in d.metadata)"name"!==a&&c.push([a,d.metadata[a]]);return{tableDecorations:"bundle__meta_table",rowDecorations:"row",numRows:c.length,numCols:2,render:function(a,e,d){0==e?d.setAttribute("class","col bundle__meta_type"):d.setAttribute("class","col");d.textContent=c[a][e]}}};d.getElementType=function(d,c){return void 0!==d?d:c};d.renderTable=function(f,c){var a=d.getElementType(c.tableElementType,"table"),b=d.getElementType(c.rowElementType,
"tr"),e=d.getElementType(c.columnElementType,"td"),a=document.createElement(a);void 0!==c.tableDecorations&&a.setAttribute("class",c.tableDecorations);for(var k=0;k<c.numRows;k++){var g=document.createElement(b);if(0<c.numCols)for(var h=0;h<c.numCols;h++){var l=document.createElement(e);c.render(k,h,l);g.appendChild(l)}else c.render(k,g);a.appendChild(g)}void 0!=f.firstChild&&f.removeChild(f.firstChild);f.appendChild(a)};d.prototype.render=function(f){var c=$(this.template.cloneNode(!0));c.find(".bundle-name").text(f.metadata.name);
c.find(".bundle-icon-sm").removeClass("bundle-icon-sm").addClass("bundle-icon-sm--"+f.bundle_type+"--"+f.state);c.find(".bundle-uuid").text(f.uuid);c.find(".bundle-link").attr("href","/bundles/"+f.uuid);c.find(".bundle-download").on("click",function(a){alert("This will allow you to download the bundle");a.preventDefault()});var a=c.find(".bundle-meta-view-container").get(0);d.renderTable(a,d.getMetadataTableModel(f));var a=c.find(".bundle__expand_button"),b=c.find(".bundle-file-view-container");a.on("click",
function(a){var c=$(a.target);if(c.hasClass("expanded"))b.removeClass("expanded"),b.children().removeClass("expanded"),c.removeClass("expanded"),c.html('SHOW BUNDLE CONTENT<img src="/static/img/expand-arrow.png" alt="More">');else{if(void 0==b.get(0).firstChild){var g=new BundleContentNode("/api/bundles/content",f.uuid);d.loadContentAsync(b.get(0),g)}else b.children().addClass("expanded");b.addClass("expanded");c.addClass("expanded");c.html('HIDE BUNDLE CONTENT<img src="/static/img/expand-arrow.png" alt="Less">')}a.preventDefault()});
return c.get(0)};return d}(),WorksheetRenderer=function(){return function(d,f,c){this.renderer=f;if(c&&c.items&&Array.isArray(c.items)){var a=this;f=c.name;if(0<c.items.length){var b=c.items[0];null===b[0]&&0==b[1].indexOf("#")&&(f=markdown.toHTML(b[1]).replace(/^<h1>/,"").replace(/<\/h1>$/,""),c.items=c.items.slice(1))}$(".worksheet-icon").html(f);$(".worksheet-author").html("by codalab");c.items.forEach(function(b){if(null===b[0]){var c=document.createElement("div");c.innerHTML=markdown.toHTML(b[1]);
d.appendChild(c)}else d.appendChild(a.renderer.render(b[0]))});MathJax.Hub.Queue(["Typeset",MathJax.Hub,d.id]);MathJax.Hub.Queue(function(){for(var a=MathJax.Hub.getAllJax(),b=0;b<a.length;b+=1)$(a[b].SourceElement().parentNode).addClass("coda-jax")})}}}();var Competition;
(function(d){function f(a,b){b?(a.removeClass("leaderBoardSubmit"),a.addClass("leaderBoardRemove"),a.text("Remove from Leaderboard")):(a.removeClass("leaderBoardRemove"),a.addClass("leaderBoardSubmit"),a.text("Submit to Leaderboard"))}function c(a,b,e,c){a="/api/competition/"+a+"/submission/"+b+"/leaderboard";var d="delete";c.hasClass("leaderBoardSubmit")&&(d="post");request=$.ajax({url:a,type:d,datatype:"text",data:{csrfmiddlewaretoken:e},success:function(a,e,m){(a="post"==d)?(e=$("#user_results td.status"),
e.removeClass("submitted"),e.addClass("not_submitted"),e.html(""),e=$("#"+b+" td.status"),e.addClass("submitted"),e.html("<i class='fi-check'></i>"),$("#user_results button.leaderBoardRemove").each(function(a){f($(this),!1)})):(e=$("#"+b+" td.status"),e.removeClass("submitted"),e.addClass("not_submitted"),e.html(""));f(c,a)},error:function(a,b,e){alert("An error occurred. Please try again or report the issue")},beforeSend:function(a){a.setRequestHeader("X-CSRFToken",e)}})}d.invokePhaseButtonOnOpen=
function(a){var b=$("#"+a+" .button.selected")[0];void 0===b&&(b=$("#"+a+" .button.active")[0],void 0===b&&(b=$("#"+a+" .button")[0]));b.click()};d.getPhaseSubmissions=function(a,b,e){$(".competition_submissions").html("").append("<div class='competitionPreloader'></div>").children().css({top:"200px",display:"block"});$.ajax({type:"GET",url:"/competitions/"+a+"/submissions/"+b,cache:!1,success:function(b){$(".competition_submissions").html("").append(b);!1===CodaLab.FileUploader.isSupported()?($("#fileUploadButton").addClass("disabled"),
$("#details").html("Sorry, your browser does not support the HTML5 File API. Please use a newer browser.")):new CodaLab.FileUploader({buttonId:"fileUploadButton",sasEndpoint:"/api/competition/"+a+"/submission/sas",allowedFileTypes:["application/zip","application/x-zip-compressed"],maxFileSizeInBytes:1073741824,beforeSelection:function(a,b){$("#fileUploadButton").addClass("disabled")},afterSelection:function(a,b){!1===b&&(0<a.files.length&&("type-error"===a.files[0].errors[0].kind?$("#details").html("Please select a valid file. Only ZIP files are accepted."):
$("#details").html("The files that you selected is too large. There is a 1GB size limit.")),$("#fileUploadButton").removeClass("disabled"))},uploadProgress:function(a,b,e){b=100*b/e;$("#details").html("Uploading file <em>"+a.name+"</em>: "+b.toFixed(0)+"% complete.")},uploadError:function(a){$("#details").html("There was an error uploading the file. Please try again.");$("#fileUploadButton").removeClass("disabled")},uploadSuccess:function(b,e){$("#details").html("Creating new submission...");$.ajax({url:"/api/competition/"+
a+"/submission",type:"post",cache:!1,data:{id:e,name:b.name,type:b.type,size:b.size}}).done(function(a){$("#details").html("");$("#user_results tr.noData").remove();$("#user_results").append(d.displayNewSubmission(a));$("#user_results #"+a.id+" .fi-plus").on("click",function(){d.showOrHideSubmissionDetails(this)});$("#fileUploadButton").removeClass("disabled");$("#user_results #"+a.id+" .fi-plus").click()}).fail(function(a){var b="An unexpected error occured.";403==a.status&&(b=a.responseJSON.detail);
$("#details").html(b);$("#fileUploadButton").removeClass("disabled")})}});$("#user_results .fi-plus").on("click",function(){d.showOrHideSubmissionDetails(this)})},error:function(a,b,e){$(".competition_submissions").html("<div class='alert-error'>An error occurred. Please try refreshing the page.</div>")}})};d.getPhaseResults=function(a,b){$(".competition_results").html("").append("<div class='competitionPreloader'></div>").children().css({top:"200px",display:"block"});$.ajax({type:"GET",url:"/competitions/"+
a+"/results/"+b,cache:!1,success:function(a){$(".competition_results").html("").append(a);$(".column-selectable").click(function(a){a=$(this).closest("table");$(a).find(".column-selected").removeClass();$(this).addClass("column-selected");var b=$(this).attr("name");a=a.find("td").filter(function(){return $(this).attr("name")===b}).addClass("column-selected");if(0<a.length)for(var e=a.slice().sort(function(a,b){var e=parseInt($.text([$(a).find("span")]));isNaN(e)&&(e=1E5);var c=parseInt($.text([$(b).find("span")]));
isNaN(c)&&(c=1E5);return e-c}),c=a[0].parentNode.parentNode,e=e.map(function(){return this.parentNode.cloneNode(!0)}),d=0;d<e.length;d++)$(e[d]).find("td.row-position").text($(e[d]).find("td.column-selected span").text()),c.insertBefore(e[d],a[d].parentNode),c.removeChild(a[d].parentNode)})},error:function(a,b,c){$(".competition_results").html("<div class='alert-error'>An error occurred. Please try refreshing the page.</div>")}})};d.registationCanProceed=function(){!0===$("#checkbox").is(":checked")?
$("#participateButton").removeClass("disabledStatus"):$("#participateButton").addClass("disabledStatus")};d.displayRegistrationStatus=function(a){var b="";$.ajax({type:"GET",url:"/api/competition/"+a+"/mystatus/",cache:!1,success:function(a){console.log(a);"approved"==a.status?location.reload():"pending"==a.status?(b="<div class='participateInfoBlock pendingApproval'>",b+="<div class='infoStatusBar'></div>",b+="<div class='labelArea'>",b+="<label class='regApprovLabel'>Your request to participate in this challenge has been received and a decision is pending.</label>",
b+="<label></label>",b+="</div>",b+="</div>"):"denied"==a.status&&(b="<div class='participateInfoBlock'>",b+="<div class='infoStatusBar'></div>",b+="<div class='labelArea'>",b+="<label class='regDeniedLabel'>Your request to participate in this challenge has been denied. The reason for your denied registrations is: "+a.reason+"</label>",b+="<label></label>",b+="</div>",b+="</div>");location.reload()},error:function(a,b,c){$(".competition_results").html("<div class='alert - error'>An error occurred. Please try refreshing the page.</div>")}});
return b};d.displayNewSubmission=function(a){var b=$("#submission_details_template #submission_row_template tr").clone();$(b).attr("id",a.id.toString());$(b).addClass(d.oddOrEven(a.submission_number));$(b).children().each(function(b){switch(b){case 0:"finished"===a.status&&$(this).val("1");break;case 1:$(this).html(a.submission_number.toString());break;case 2:$(this).html(a.filename);break;case 3:var c=function(a){a=a.toString();1==a.length&&(a="0"+a);return a},f=new Date(a.submitted_at);b=$.datepicker.formatDate("mm/dd/yy",
f).toString();var h=f.getHours().toString(),l=c(f.getMinutes()),c=c(f.getSeconds());$(this).html(b+" "+h+":"+l+":"+c);break;case 4:$(this).html(d.getSubmissionStatus(a.status))}});return b};d.oddOrEven=function(a){return a&1?"odd":"even"};d.getSubmissionStatus=function(a){var b="Unknown";"submitting"===a?b="Submitting":"submitted"===a?b="Submitted":"running"===a?b="Running":"failed"===a?b="Failed":"cancelled"===a?b="Cancelled":"finished"===a&&(b="Finished");return b};d.showOrHideSubmissionDetails=
function(a){var b=$(a).parents("tr")[0];if($(a).hasClass("fi-minus"))$(a).removeClass("fi-minus"),$(a).addClass("fi-plus"),$(b).next("tr.trDetails").remove();else{$(a).removeClass("fi-plus");$(a).addClass("fi-minus");a=$("#submission_details_template .trDetails").clone();a.find(".tdDetails").attr("colspan",b.cells.length);a.find("a").each(function(a){$(this).attr("href",$(this).attr("href").replace("_",b.id))});var e=$("#phasestate").val(),k=$(b).find("input[name='state']").val();if(1==e&&1==k){var g=
a.find("button");g.removeClass("hide");var e=$(b).find(".status").hasClass("submitted"),h=$("#competitionId").val();f(g,e);g.on("click",function(){c(h,b.id,$("#cstoken").val(),g)})}else{e=$.trim($(b).find(".statusName").html());g=a.find("button").addClass("hide");if("Submitting"===e||"Submitted"===e||"Running"===e)g.removeClass("hide"),g.text("Refresh status"),g.on("click",function(){d.updateSubmissionStatus($("#competitionId").val(),b.id,this)});"Failed"!==e&&"Cancelled"!==e||a.find("a").removeClass("hide")}$(b).after(a)}};
d.updateSubmissionStatus=function(a,b,e){$(e).parents(".submission_details").find(".preloader-handler").append("<div class='competitionPreloader'></div>").children().css({top:"25px",display:"block"});$.ajax({type:"GET",url:"/api/competition/"+a+"/submission/"+b,cache:!1,success:function(f){$("#user_results #"+b).find(".statusName").html(d.getSubmissionStatus(f.status));if("finished"===f.status)$("#user_results #"+b+"input:hidden").val("1"),1==$("#phasestate").val()?($(e).addClass("leaderBoardSubmit"),
$(e).text("Submit to Leaderboard"),$(e).on("click",function(){c(a,b,$("#cstoken").val(),$(e))})):$(e).addClass("hide");else if("failed"===f.status||"cancelled"===f.status)$(e).addClass("hide"),$(e).parent().parent().find("a").removeClass("hide");$(".competitionPreloader").hide()},error:function(a,b,e){}})}})(Competition||(Competition={}));var prTable;
$(document).ready(function(){$("#participate_form").submit(function(d){d.preventDefault();if($("#participateButton").hasClass("disabledStatus"))return!1;$("#result").html("");d=$(this).serialize();var c=$("#competitionId").val();request=$.ajax({url:"/api/competition/"+c+"/participate/",type:"post",dataType:"text",data:d,success:function(a,b,e){$(".content form").replaceWith(Competition.displayRegistrationStatus(c))},error:function(a,b,e){alert("There was a problem registering for this competition.")}});
return!1});$("#submissions_phase_buttons .button").each(function(d,c){$(this).click(function(){var a=$.trim($(this).attr("id").replace("submissions_phase_",""));$("#submissions_phase_buttons .button").removeClass("selected");$(this).addClass("selected");var b=$("#competitionId").val(),e=$("#cstoken").val();Competition.getPhaseSubmissions(b,a,e)})});$("a[href='#participate-submit_results']").click(function(d){Competition.invokePhaseButtonOnOpen("submissions_phase_buttons")});$("#results_phase_buttons .button").each(function(d,
c){$(this).click(function(){var a=$.trim($(this).attr("id").replace("results_phase_",""));$("#results_phase_buttons .button").removeClass("selected");$(this).addClass("selected");var b=$("#competitionId").val();Competition.getPhaseResults(b,a)})});$("#Results").click(function(d){Competition.invokePhaseButtonOnOpen("results_phase_buttons")});$(this).foundation("section","reflow");$(".top-bar-section ul > li").removeClass("active");$("#liCompetitions").addClass("active");$(".my_managing .competition-tile #competition-actions").each(function(d,
c){$(this).children("#competition-publish-button").click(function(){var a=$(this).parent()[0];request=$.ajax({url:$(this)[0].value,success:function(b,e,c){console.log("Published competition.");$(a).children("#competition-publish-button").hide();$(a).children("#competition-delete-button").hide();$(a).children("#competition-unpublish-button").show()},error:function(a,e,c){console.log("Error publishing competition!")}})});$(this).children("#competition-unpublish-button").click(function(){});"True"==
$(this)[0].getAttribute("published")?($(this).children("#competition-delete-button").hide(),$(this).children("#competition-publish-button").hide(),$(this).children("#competition-unpublish-button").show()):($(this).children("#competition-delete-button").show(),$(this).children("#competition-publish-button").show(),$(this).children("#competition-unpublish-button").hide())});var d=window.location.href;void 0!==d&&(null!==d.match(/#participate-submit_results$/i)?Competition.invokePhaseButtonOnOpen("submissions_phase_buttons"):
null!==d.match(/#results$/i)&&Competition.invokePhaseButtonOnOpen("results_phase_buttons"))});var csrftoken;$(function(){csrftoken=$.cookie("csrftoken");$.ajaxSetup({beforeSend:function(d,f){var c;if(c=!/^(GET|HEAD|OPTIONS|TRACE)$/.test(f.type)){c=f.url;var a="//"+document.location.host,b=document.location.protocol+a;c=c==b||c.slice(0,b.length+1)==b+"/"||c==a||c.slice(0,a.length+1)==a+"/"||!/^(\/\/|http:|https:).*/.test(c)}c&&d.setRequestHeader("X-CSRFToken",csrftoken)}})});var CodaLab;
(function(d){var f=function(){function c(a){var b=this;this.defaultOptions={buttonId:"fileUploadButton",disabledClassName:"disabled",beforeSelection:function(){},afterSelection:function(a,b){},uploadProgress:function(a,b,e){},uploadSuccess:function(a){},uploadError:function(a){},allowedFileTypes:void 0,maxFileSizeInBytes:void 0,maxBlockSizeInBytes:1048576};this.options=$.extend({},this.defaultOptions,a);var e=$("#"+this.options.buttonId);this.setupFileInput();e.after(this.fileInput);e.on("click",
function(a){e.hasClass(b.options.disabledClassName)||b.fileInput.click()})}c.prototype.setupFileInput=function(){var a=this,b=this.fileInput;this.fileInput=$(document.createElement("input"));this.fileInput.attr("type","file");this.fileInput.attr("style","visibility: hidden; width: 1px; height: 1px;");this.fileInput.on("change",function(b){a.options.beforeSelection();b=a.validate();var d=0<b.files.length&&!0===c.selectionIsValid(b);a.options.afterSelection(b,d);d?a.beginUpload(b,0):a.setupFileInput()});
void 0!==b&&b.replaceWith(this.fileInput)};c.prototype.validate=function(){var a=this,b=this.fileInput.get(0).files,e=[];0<b.length&&$.each(b,function(b,c){var d=[];a.options.maxFileSizeInBytes&&c.size>a.options.maxFileSizeInBytes&&d.push({kind:"size-error"});a.options.allowedFileTypes&&-1===$.inArray(c.type,a.options.allowedFileTypes)&&d.push({kind:"type-error"});e.push({file:c,errors:d})});return{files:e}};c.selectionIsValid=function(a){return 0===a.files.map(function(a){return a.errors.length}).reduce(function(a,
e,c,d){return a+e},0)};c.prototype.getCurrentFile=function(){if(void 0!==this.state)return this.state.selection.files[this.state.fileIndex].file};c.prototype.getFileReader=function(){var a=this,b=new FileReader;b.onload=function(b){var c=a.state.sasUrl+"&comp=block&blockid="+a.state.blockIds[a.state.blockIds.length-1];b=new Uint8Array(b.target.result);var d=a.state.sasVersion;$.ajax({url:c,type:"PUT",data:b,processData:!1,beforeSend:function(a){a.setRequestHeader("x-ms-version",d);a.setRequestHeader("x-ms-blob-type",
"BlockBlob")},success:function(b,c){var e=a.getCurrentFile();a.options.uploadProgress(e,a.state.bytesUploaded,e.size);a.state.bytesUploaded<e.size?a.upload():a.endUpload()},error:function(b,c,e){a.options.uploadError({kind:"write-error",jqXHR:b,file:a.getCurrentFile()})}})};b.onerror=function(b){a.options.uploadError({kind:"read-error",message:b.message,file:a.getCurrentFile()})};return b};c.prototype.beginUpload=function(a,b){this.state={sasUrl:void 0,sasVersion:void 0,trackingId:void 0,reader:void 0,
selection:a,fileIndex:b,blockIds:[],bytesUploaded:0};var c=this.getCurrentFile(),d=this;$.ajax({url:d.options.sasEndpoint,type:"POST",data:{name:c.name,type:c.type,size:c.size},success:function(a,b){d.state.sasUrl=a.url;d.state.sasVersion=a.version;d.state.trackingId=a.id;d.state.reader=d.getFileReader();d.options.uploadProgress(c,d.state.bytesUploaded,c.size);d.upload()},error:function(a,b,c){d.options.uploadError({kind:"sas-error",jqXHR:a,file:d.getCurrentFile()})}})};c.prototype.upload=function(){var a=
this.getCurrentFile(),b=this.state.bytesUploaded,c=b+Math.min(a.size-b,this.options.maxBlockSizeInBytes),a=a.slice(b,c),b="000000"+(this.state.blockIds.length+1),b=btoa(b.substring(b.length-6));this.state.blockIds.push(b);this.state.bytesUploaded=c;this.state.reader.readAsArrayBuffer(a)};c.prototype.endUpload=function(){var a=this.state.sasUrl+"&comp=blocklist",b=this.getCurrentFile(),c=['<?xml version="1.0" encoding="utf-8"?>'];c.push("<BlockList>");for(var d=0;d<this.state.blockIds.length;d++)c.push("  <Latest>"+
this.state.blockIds[d]+"</Latest>");c.push("</BlockList>");var f=this;$.ajax({url:a,type:"PUT",contentType:"application/xml",processData:!1,data:c.join("\n"),beforeSend:function(a){a.setRequestHeader("x-ms-version",f.state.sasVersion);a.setRequestHeader("x-ms-blob-content-type",b.type);a.setRequestHeader("x-ms-meta-name",b.name);a.setRequestHeader("x-ms-meta-size",b.size.toString())},success:function(a,c){f.options.uploadSuccess(b,f.state.trackingId);var d=1+f.state.fileIndex;d<f.state.selection.files.length?
f.beginUpload(f.state.selection,d):f.setupFileInput()},error:function(a,b,c){f.options.uploadError({kind:"write-error",jqXHR:a,file:f.getCurrentFile()})}})};c.isSupported=function(){return window.File&&window.FileReader&&window.FileList&&window.Blob?!0:!1};return c}();d.FileUploader=f;(function(c){c.CreateReady=function(){!1===f.isSupported()?($("#uploadButton").addClass("disabled"),$("#details").html("Sorry, your browser does not support the HTML5 File API. Please use a newer browser.")):new f({buttonId:"uploadButton",
sasEndpoint:"/api/competition/create/sas",allowedFileTypes:["application/zip","application/x-zip-compressed"],maxFileSizeInBytes:1073741824,beforeSelection:function(a,b){$("#uploadButton").addClass("disabled")},afterSelection:function(a,b){!1===b&&(0<a.files.length&&("type-error"===a.files[0].errors[0].kind?$("#details").html("Please select a valid file. Only ZIP files are accepted."):$("#details").html("The files that you selected is too large. There is a 1GB size limit.")),$("#uploadButton").removeClass("disabled"))},
uploadProgress:function(a,b,c){b=100*b/c;$("#details").html("Uploading file <em>"+a.name+"</em>: "+b.toFixed(0)+"% complete.")},uploadError:function(a){$("#details").html("There was an error uploading the file. Please try again.");$("#uploadButton").removeClass("disabled")},uploadSuccess:function(a,b){$("#details").html("Creating competition... This may take a while. Please be patient.");$.ajax({url:"/api/competition/create",type:"post",cache:!1,data:{id:b,name:a.name,type:a.type,size:a.size}}).done(function(a){var b=
function(){$.ajax({url:"/api/competition/create/"+a.token,type:"get",cache:!1,data:{csrfmiddlewaretoken:$("input[name='csrfmiddlewaretoken']").val()}}).done(function(a){"finished"==a.status?($("#details").html("Congratulations! Your new competition is ready to <a href='/competitions/"+a.id+"'>view</a>. You can also manage it from <a href='/my/#manage'>your CodaLab dashboard.</a>"),$("#uploadButton").removeClass("disabled")):"failed"==a.status?($("#details").html("Oops! There was a problem creating the competition."),
$("#uploadButton").removeClass("disabled")):setTimeout(b,1E3)}).fail(function(){$("#details").html("An unexpected error occured.");$("#uploadButton").removeClass("disabled")})};b()}).fail(function(){$("#details").html("An unexpected error occured.");$("#uploadButton").removeClass("disabled")})}})}})(d.Competitions||(d.Competitions={}))})(CodaLab||(CodaLab={}));//# sourceMappingURL=/static/js/codalab.min.map
